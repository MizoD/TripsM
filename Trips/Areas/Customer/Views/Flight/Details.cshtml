@model FlightDetailsViewVM

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Flight Details";
}

<div class="max-w-5xl mx-auto bg-white p-8 rounded-lg shadow-xl">
    <!-- Breadcrumb -->
    <nav class="text-sm font-medium text-gray-500 mb-6">
        <ol class="list-none p-0 inline-flex">
            <li class="flex items-center">
                <a asp-area="Customer" asp-controller="Home" asp-action="Index"
                   class="text-blue-600 hover:text-blue-800 transition-colors">Home</a>
                <svg class="fill-current w-3 h-3 mx-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                    <path d="M12.95 10.707l.707-.707L8 4.343 6.586 5.757 10.828 10l-4.242 4.243 1.414 1.414L12.95 10.707z" />
                </svg>
            </li>
            <li class="flex items-center">
                <a asp-area="Customer" asp-controller="Flight" asp-action="Index"
                   class="text-blue-600 hover:text-blue-800 transition-colors">Flights</a>
                <svg class="fill-current w-3 h-3 mx-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                    <path d="M12.95 10.707l.707-.707L8 4.343 6.586 5.757 10.828 10l-4.242 4.243 1.414 1.414L12.95 10.707z" />
                </svg>
            </li>
            <li class="flex items-center">
                <span class="text-gray-700">@Model.Flight.Title</span>
            </li>
        </ol>
    </nav>

    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-gray-900">@Model.Flight.Title</h1>
        <span class="text-sm px-3 py-1 rounded-full bg-gray-200">@Model.Flight.Status</span>
    </div>

    <!-- Flight Info -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div class="space-y-3">
            <p><span class="font-semibold text-gray-700">From:</span> @Model.Flight.DepartureAirport?.Name</p>
            <p><span class="font-semibold text-gray-700">To:</span> @Model.Flight.ArrivalAirport?.Name</p>
            <p><span class="font-semibold text-gray-700">Departure:</span> @Model.Flight.DepartureTime.ToString("MMM dd, yyyy HH:mm")</p>
            <p><span class="font-semibold text-gray-700">Arrival:</span> @Model.Flight.ArrivalTime.ToString("MMM dd, yyyy HH:mm")</p>
            <p><span class="font-semibold text-gray-700">Duration:</span> @Model.Flight.Duration.ToString(@"hh\:mm")</p>
        </div>

        <div class="space-y-3">
            <p><span class="font-semibold text-gray-700">Aircraft:</span> @Model.Flight.Aircraft?.Model (@Model.Flight.Aircraft?.AirlineName)</p>
            <p><span class="font-semibold text-gray-700">Trip:</span> @(Model.Flight.Trip?.Title ?? "N/A")</p>
            <p><span class="font-semibold text-gray-700">Total Seats:</span> @Model.Flight.TotalSeats</p>
            <p><span class="font-semibold text-gray-700">Available Seats:</span> @Model.Flight.AvailableSeats</p>
            <p><span class="font-semibold text-gray-700">Booked Seats:</span> @Model.Flight.BookedSeats</p>
        </div>
    </div>

    <!-- Pricing Section -->
    <div class="bg-gray-50 border rounded-lg p-4 mb-6">
        <h2 class="text-lg font-semibold mb-3">Pricing</h2>
        <ul class="space-y-2">
            <li>Economy: <b>$@Model.Flight.GetPriceForCoach(Models.Coach.Economy)</b></li>
            <li>Business: <b>$@Model.Flight.GetPriceForCoach(Models.Coach.Business)</b></li>
            <li>First Class: <b>$@Model.Flight.GetPriceForCoach(Models.Coach.FirstClass)</b></li>
        </ul>
    </div>

    <!-- Seats Section -->
    <div class="bg-gray-50 border rounded-lg p-4 mb-6">
        <h2 class="text-lg font-semibold mb-3">Seats Overview</h2>
        @if (Model.Flight.Seats != null && Model.Flight.Seats.Any())
        {
            <table class="w-full border-collapse">
                <thead>
                    <tr class="bg-gray-100 text-left">
                        <th class="px-3 py-2 border">Seat Number</th>
                        <th class="px-3 py-2 border">Coach</th>
                        <th class="px-3 py-2 border">Status</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var seat in Model.Flight.Seats)
                    {
                        <tr>
                            <td class="px-3 py-2 border">@seat.SeatLabel</td>
                            <td class="px-3 py-2 border">@seat.Coach</td>
                            <td class="px-3 py-2 border">
                                @if (seat.IsBooked)
                                {
                                    <span class="text-red-600 font-semibold">Booked</span>
                                }
                                else
                                {
                                    <span class="text-green-600 font-semibold">Available</span>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <p class="text-gray-500">No seats data available.</p>
        }
    </div>

    <!-- Seat Map Section -->
    <div class="mt-10 p-6 bg-gray-100 rounded-lg shadow-md">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">Seat Map</h2>

        <div class="grid grid-cols-6 gap-3 justify-center">
            @foreach (var seat in Model.Seats)
            {
                <div class="
                    flex items-center justify-center w-12 h-12 rounded-md cursor-pointer
                    @(seat.IsBooked
                                         ? "bg-red-500 text-white cursor-not-allowed"
                                         : "bg-green-500 text-white hover:bg-green-600")"
                 title="Seat: @seat.SeatLabel (@(seat.IsBooked ? "Booked" : "Available"))">
                @seat.SeatLabel
            </div>
                        }
        </div>

        <!-- Legend -->
        <div class="flex justify-center mt-6 space-x-6 text-sm">
            <div class="flex items-center space-x-2">
                <div class="w-5 h-5 bg-green-500 rounded"></div>
                <span>Available</span>
            </div>
            <div class="flex items-center space-x-2">
                <div class="w-5 h-5 bg-red-500 rounded"></div>
                <span>Booked</span>
            </div>
        </div>
    </div>

    <!-- Book Button -->
    <div class="mt-6">
        <a asp-area="Customer" asp-controller="Booking" asp-action="Create" asp-route-flightId="@Model.Flight.Id"
           class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition">
            Book This Flight
        </a>
    </div>

    <!-- Related Flights -->
    <div class="mt-10">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Related Flights</h2>

        @if (Model.RelatedFlights.Any())
        {
            <div class="grid md:grid-cols-2 gap-4">
                @foreach (var related in Model.RelatedFlights)
                {
                    <div class="border rounded-lg p-4 shadow hover:shadow-md transition">
                        <h3 class="text-lg font-semibold text-gray-800">@related.Title</h3>
                        <p class="text-gray-600 text-sm">
                            From: <b>@related.DepartureAirport?.Name</b> → To: <b>@related.ArrivalAirport?.Name</b>
                        </p>
                        <p class="text-gray-600 text-sm">
                            Departure: @related.DepartureTime.ToString("MMM dd, yyyy HH:mm")
                        </p>
                        <p class="text-gray-900 font-bold mt-2">
                            Price: $@related.Price
                        </p>
                        <a asp-area="Customer" asp-controller="Flight" asp-action="Details" asp-route-id="@related.Id"
                           class="inline-block mt-3 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                            View Details
                        </a>
                    </div>
                }
            </div>
        }
        else
        {
            <p class="text-gray-500">No related flights available.</p>
        }
    </div>
</div>
