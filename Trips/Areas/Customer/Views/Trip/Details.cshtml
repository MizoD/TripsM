@model TripDetailsViewModel

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = Model.Trip.Title;
}

<div class="max-w-6xl mx-auto bg-white p-8 rounded-lg shadow-xl">

    <!-- Breadcrumb -->
    <nav class="text-sm font-medium text-gray-500 mb-6">
        <ol class="list-none p-0 inline-flex">
            <li class="flex items-center">
                <a asp-area="Customer" asp-controller="Home" asp-action="Index"
                   class="text-blue-600 hover:text-blue-800 transition-colors">Home</a>
                <svg class="fill-current w-3 h-3 mx-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                    <path d="M12.95 10.707l.707-.707L8 4.343 6.586 5.757 10.828 10l-4.242 4.243 1.414 1.414L12.95 10.707z" />
                </svg>
            </li>
            <li class="flex items-center">
                <span class="text-gray-700">@Model.Trip.Title</span>
            </li>
        </ol>
    </nav>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">     

        <!-- Trip Info & Images -->
        <div class="md:col-span-2 space-y-4">
            <!-- Carousel -->
            <div class="relative w-full overflow-hidden rounded-lg shadow">
                <div class="flex transition-transform duration-500" id="carouselInner">
                    @if (Model.TripImages != null && Model.TripImages.Any())
                    {
                        @foreach (var img in Model.TripImages)
                        {
                            <img src="@img" alt="@Model.Trip.Title" class="w-full h-64 md:h-96 object-cover flex-shrink-0" />
                        }
                    }
                    else
                    {
                        <img src="/images/no-image.png" alt="No Image" class="w-full h-64 md:h-96 object-cover flex-shrink-0" />
                    }
                </div>

                <!-- Navigation buttons -->
                <button onclick="prevSlide()" class="absolute top-1/2 left-2 transform -translate-y-1/2 bg-gray-800 text-white rounded-full px-2 py-1 opacity-70 hover:opacity-100 transition">‹</button>
                <button onclick="nextSlide()" class="absolute top-1/2 right-2 transform -translate-y-1/2 bg-gray-800 text-white rounded-full px-2 py-1 opacity-70 hover:opacity-100 transition">›</button>
            </div>

            <script>
                let currentIndex = 0;
                const slides = document.querySelectorAll('#carouselInner img');

                function showSlide(index) {
                    const offset = -index * 100;
                    document.getElementById('carouselInner').style.transform = `translateX(${offset}%)`;
                }

                function nextSlide() {
                    currentIndex = (currentIndex + 1) % slides.length;
                    showSlide(currentIndex);
                }

                function prevSlide() {
                    currentIndex = (currentIndex - 1 + slides.length) % slides.length;
                    showSlide(currentIndex);
                }
            </script>

            <h1 class="text-3xl font-bold">@Model.Trip.Title</h1>
            <p>@Model.Trip.Description</p>

            <p class="text-gray-900 font-bold text-xl">Price: $@Model.Trip.Price</p>
            <p>Country: <b>@Model.Trip.CountryName</b></p>
            <p>Type: <b>@Model.Trip.TripType</b></p>
            <p>Available Seats: <b>@Model.Trip.AvailableSeats</b> / @Model.Trip.TotalSeats</p>
            <p>Duration: <b>@Model.Trip.DurationDays</b> days</p>
            <p>Dates: @Model.Trip.StartDate.ToShortDateString() - @Model.Trip.EndDate.ToShortDateString()</p>
        </div>

        <!-- Booking Section -->
        <div>
            <form asp-action="BookTrip" method="post" class="space-y-4">
                <input type="hidden" name="tripId" value="@Model.Trip.Id" />
                <label>Seats:</label>
                <input type="number" name="seats" min="1" max="@Model.Trip.AvailableSeats"
                       class="w-full border rounded-lg px-3 py-2" required />
                <button type="submit" class="w-full bg-green-600 text-white px-4 py-2 rounded">Book Now</button>
            </form>
        </div>
    </div>

    <!-- Related Trips -->
    <h2 class="text-2xl font-bold mt-10">Related Trips</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
        @if (Model.RelatedTrips != null && Model.RelatedTrips.Any())
        {
            @foreach (var trip in Model.RelatedTrips)
            {
                <div class="border rounded-lg shadow hover:shadow-md transition overflow-hidden">
                    <img src="@(!string.IsNullOrEmpty(trip.ImageUrl) ? trip.ImageUrl : "/images/no-image.png")"
                         alt="@trip.Title" class="w-full h-40 object-cover" />
                    <div class="p-3">
                        <h3 class="text-lg font-semibold">@trip.Title</h3>
                        <p class="text-gray-700 text-sm">Price: $@trip.Price</p>

                        <!-- Star Rating -->
                        <div class="flex items-center mt-1 mb-2">
                            @for (int i = 1; i <= 5; i++)
                            {
                                if (i <= Math.Round(trip.AverageRating))
                                {
                                    <svg class="w-4 h-4 text-yellow-400 fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                        <path d="M10 15l-5.878 3.09 1.122-6.545L.487 6.91l6.561-.955L10 0l2.952 5.955 6.561.955-4.757 4.635 1.122 6.545z" />
                                    </svg>
                                }
                                else
                                {
                                    <svg class="w-4 h-4 text-gray-300 fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                        <path d="M10 15l-5.878 3.09 1.122-6.545L.487 6.91l6.561-.955L10 0l2.952 5.955 6.561.955-4.757 4.635 1.122 6.545z" />
                                    </svg>
                                }
                            }
                            <span class="text-sm text-gray-500 ml-1">(@trip.ReviewCount)</span>
                        </div>

                        <a asp-area="Customer" asp-controller="Trip" asp-action="Details" asp-route-id="@trip.Id"
                           class="inline-block mt-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 transition">
                            View
                        </a>
                    </div>
                </div>
            }
        }
        else
        {
            <p class="text-gray-500 col-span-full">No related trips available.</p>
        }
    </div>

    <!-- Reviews Section -->
    <h2 class="text-2xl font-bold text-gray-900 mt-10 mb-4">Traveler Reviews</h2>

    <div class="space-y-6">
        @if (Model.Reviews != null && Model.Reviews.Any())
        {
            foreach (var review in Model.Reviews)
            {
                <div class="border rounded-lg p-4 shadow-sm bg-gray-50">
                    <div class="flex items-center justify-between">
                        <span class="font-semibold text-gray-900">@review.UserName</span>
                        <span class="text-sm text-gray-500">@review.CreatedAt.ToShortDateString()</span>
                    </div>

                    <!-- Star Rating -->
                    <div class="flex items-center mt-1 mb-2">
                        @for (int i = 1; i <= 5; i++)
                        {
                            if (i <= review.Rating)
                            {
                                <svg class="w-5 h-5 text-yellow-400 fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                    <path d="M10 15l-5.878 3.09 1.122-6.545L.487 6.91l6.561-.955L10 0l2.952 5.955 6.561.955-4.757 4.635 1.122 6.545z" />
                                </svg>
                            }
                            else
                            {
                                <svg class="w-5 h-5 text-gray-300 fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                    <path d="M10 15l-5.878 3.09 1.122-6.545L.487 6.91l6.561-.955L10 0l2.952 5.955 6.561.955-4.757 4.635 1.122 6.545z" />
                                </svg>
                            }
                        }
                    </div>

                    <p class="text-gray-700">@review.Comment</p>
                </div>
            }
        }
        else
        {
            <p class="text-gray-500">No reviews yet. Be the first to leave a review!</p>
        }
    </div>

    <!-- Add Review Form -->
    <h3 class="text-xl font-bold text-gray-900 mt-8 mb-4">Leave a Review</h3>
    <form asp-action="AddReview" method="post" class="space-y-4">
        <input type="hidden" name="tripId" value="@Model.Trip.Id" />

        <div>
            <label class="block text-gray-700 font-medium">Your Name</label>
            <input type="text" name="userName" class="w-full border rounded-lg px-3 py-2 focus:ring focus:ring-blue-300" required />
        </div>

        <div>
            <label class="block text-gray-700 font-medium">Rating</label>
            <select name="rating" class="w-full border rounded-lg px-3 py-2 focus:ring focus:ring-blue-300" required>
                <option value="5">★★★★★ (5)</option>
                <option value="4">★★★★☆ (4)</option>
                <option value="3">★★★☆☆ (3)</option>
                <option value="2">★★☆☆☆ (2)</option>
                <option value="1">★☆☆☆☆ (1)</option>
            </select>
        </div>

        <div>
            <label class="block text-gray-700 font-medium">Comment</label>
            <textarea name="comment" rows="3" class="w-full border rounded-lg px-3 py-2 focus:ring focus:ring-blue-300"></textarea>
        </div>

        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">
            Submit Review
        </button>
    </form>
</div>